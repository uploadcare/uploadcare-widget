## Рамка диалога

Есть общий объект "рамка диалога" — `uploadcare.widget.__dialogFrame`, которая 
умеет показывать "содержимое" — `dialogContent`.

Есть только 2 публичный метода:

```coffeescript
__dialogFrame.show(dialogContent)
__dialogFrame.isOpened()
```

Требования к `dialogContent`:

 - это Promise (`__dialogFrame` отсоединяет содержимое при `always`)
 - есть метод `dialogContent.el()` возвращающий элемент для вставки в рамку
 - необязательный метод `dialogContent.closed()` (будет вызван когда пользователь закроет диалог)

Также `__dialogFrame` добавляет в `dialogContent` метод `dialogContent.__detachFromFrame()`,
вызвав который можно отсоединиться от диалога.

После отсоединения диалог закрывается через 100ms, если за это в ремя к нему не 
присоединился другой `dialogContent`.

## Содержимое "Выбор файла"

Функция `uploadcare.widget.showChooseDialog(settings)` возвращает это "содержимое". Причем 
метод `__dialogFrame.show()` вызывается в "конструкторе". 
Т.е. после вызова `showChooseDialog()` диалог уже отображается, ничего делать не 
нужно — мы получаем Promise, который вернет нам файл для загрузки.

```coffeescript
showChooseDialog().done (filesToUpload) ->
  ...
```

## Содержимое "Превью"

`uploadcare.widget.showPreviewDialog(settings, step1Pr, getNewStep1Pr)`

Для создания этого "содержимого", помимо настроек нужно передать еще promise, и 
функцию которая может сгенерировать новый promise (для кнопки "назад").

Сам promise тоже довольно запутанный, он должен ресолвится со следующими данными

```coffeescript
promise.done (data) ->
  # информация о файле в одном из 3х форматов:
  #   uploadcare.files.UrlFile и uploadcare.files.EventFile (ответ ChooseDialog)
  #   FIR*
  data.fileInfo

  # это еще один promise, который всегда отдает FIR*
  data.rescueFileInfo
```

*FIR — ответ `uploadcare.uploads.fileInfo()` (не промис, а сам ответ)

Превью пытается показать файл используя `data.fileInfo`, но если не получается 
откатывается к `data.rescueFileInfo`.

## Содержимое "Кроп"

Его пока нет. Оно будет как "Превью", только когда будет ресолвиться будет 
возвращать параметры кропа.

## Работа с содержимыми из виджета

Речь идет о файле `/widget/widget.js.coffee`. Виджет работает напрямую с 
содержимыми, не думая о `__dialogFrame`.

Как это происходит можно посмотреть уже в самом файле, думаю зная всё описанное 
выше можно будет понять (и простить) почему там делается, то что делается. 
Но основной смысл в том, что каждый раз когда нужно показать диалог, нужно 
создать содержимое второго этапа (превью/кроп)
и передеать в него (в виде обещания) содержимое первого этапа, обернув его еще 
как-то чтобы обеспечить возврат `rescueFileInfo`.